<!DOCTYPE html>
<html>
<head>
	<title>this is a robot</title>
	<meta charset="utf8">
	<link rel="stylesheet" type="text/css" href="form.css">
 	<script type="text/javascript" src="./common.js"></script>
 	<script type="text/javascript" src="./robot.class.js"></script>
	<link rel="stylesheet" href="./robot.css">
</head>
<body>
<div class="talkModule" style="display:block;">
	<div class="title">智能机器人</div>
	<div class="body">
		<!-- <div class="left item">
			<div class="avatar">
				<img src="http://placehold.it/30x30">
			</div>
			<div class="content">
				sdfsf
			</div>
		</div>
		<div class="right item">
			<div class="avatar">
				<img src="http://placehold.it/30x30">
			</div>
			<div class="content">
				sdfsf
			</div>
		</div> -->
	</div>
	<div class="formWrap"  style="margin-top:10px;background-color:#eee;display:block;clear:both;">
		<!-- <form> -->
			<p style="font-size:14px;padding:10px;color:#999;border-bottom:1px solid #bbb;">您可以选择业务类型：1、关键字查询 2、问问题 3、联合搜索 4、智能搜索 5、用户分析</p>
			<div class="collectBox"> 
				<div class="item">
					<div class="box"  value="收藏夹1">
						<div class="mask" value="收藏夹1"></div>
						<svg style="z-index:10;position:relative;top:0px;width:40px;height:40px;">
							<rect width="40" height="40" style="border-radius:10px;fill:transparent;border-radius:10px;"></rect>
							<circle cx="10" cy="10" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
							<circle cx="30" cy="10" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
							<circle cx="10" cy="30" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
							<circle cx="30" cy="30" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
						</svg>
					</div>
					<span>收藏夹1</span>
				</div>

				<div class="item">
					<div class="box"  value="收藏夹2"></div>
					<span>收藏夹2</span>
				</div>

				<div class="item">
					<div class="box" value="收藏夹3"></div>
					<span>收藏夹3</span>
				</div>

				<div class="item">
					<div class="box additem" style="font-size:60px;"></div>
					<span>命名1</span>
				</div>

				<div class="detailbox" title="收藏夹">
					<!-- <div class="detailboxitem" value="238238"></div>
					<div class="detailboxitem"></div> -->
				</div>
			</div>

			<div class="formItem"  id="sendMsg">
				<input type="" name="">
				<button>send</button>
				<button onclick="alert('暂未开放')">表情</button>
				<!--这个应该是通过用户的使用和操作，各方面得出来的结论，用户的需求。-->
				<button class="randomTopice">试试吧，说不定有惊喜呢/</button>
			</div>
			<div>
				功能按钮
				<button class="clearsc">clear screen</button>
				<button onclick="alert('暂未开放')">inform me</button>
				<button onclick="alert('暂未开放')">collect</button>
			</div>
			<!-- <div>
				<a href="">我的收藏</a>
				<a href="">用户分析</a>
				<a href="">我的提醒</a>
				<a href="">反馈</a>
			</div>
			<div>
				业务类型
				<button>1</button>
				<button>2</button>
				<button>3</button>
			</div> -->
			
		<!-- </form> -->
	</div>
</div>
</body>
<script type="text/javascript">
		//********** robot ********************//
	//robot 初始化
					var robot = new Robot();
					robot.init();
					// robot.robot();
					// robot.closeRobet()

					$item = _('.item');
					var $str = '<div class="detailboxitem" value="#value#">#content#</div>';
					//收藏过的数据id链接到保存的会话块。

					//显示一些东西
					//这是一个封装好的组件。
					//interntype 通过interntype来传递前一部点击的是什么年月日。
					function showMore (type, mock, interntype) {
						//timestemp生成器
						var xxx = new Date("2015-11-11");
						console.log(xxx.getTime())
						//年份
						switch(type) {
							case 1: 
								//show year
								var returnstr = "",
								yeararr = [];
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										date = new Date(parseInt(time)),
										year = date.getFullYear(),
										day = date.getDate();
									//所有的收藏日期day缓存
									if(yeararr.indexOf(year) == -1) { 
										yeararr.push(year);
									}
										// console.log(date, year, month,day)
								}
								yeararr.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0]);
								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(2, mock, e.srcElement.getAttribute("value"))
								});
								return $elem;
								break;
							case 2:
								//show month;
								var montharr = [],
									returnstr = "";
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										date = new Date(parseInt(time)),
										year = date.getFullYear(),
										month = date.getMonth();
										//用户点击是否同一年。
										if(parseInt(interntype) == year) {
											if(montharr.indexOf(month) == -1) {
												montharr.push(month);
											}
										}
								}
								montharr.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0]);

								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(3, mock, e.srcElement.getAttribute("value"));
									// _('.detailbox')[0].innerHTML = "";
								});
								_('.detailbox')[0].innerHTML = "";
								_('.detailbox')[0].appendChild($elem);
								break;
							case 3:
								//show day
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										returnstr = "",
										date = new Date(parseInt(time)),
										dayarr = [],
										month = date.getMonth(),
										day = date.getDate();
										if (interntype == month) {
											if(dayarr.indexOf(day) == -1) {
												dayarr.push(day);
											}
										} 
								}

								dayarr.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0])
									
								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(4, mock, e.srcElement.getAttribute("value"));
								});
								_('.detailbox')[0].innerHTML = "";
								_('.detailbox')[0].appendChild($elem);
								break;
							case 4:
								//show timestamp
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										returnstr = "",
										date = new Date(parseInt(time)),
										now = [],
										month = date.getMonth(),
										day = date.getDate();
										console.log(interntype,day)
										if (interntype == day) {
											if(now.indexOf(time) == -1) {
												now.push(time);
											}
										} 
								}
								now.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0])
									
								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(5, mock, e.srcElement.getAttribute("value"));
								});
								_('.detailbox')[0].innerHTML = "";
								_('.detailbox')[0].appendChild($elem);
								break;
							case 5:
								//display
								// for(var i=0;i<mock.length;i++) {
								// 	_('.detailbox')[0].style.display= "none";
								// 	robot.showDialog(mock[i],mock[i].type)
								// }
									_('.detailbox')[0].style.display= "none";

								for(var i=0;i<mock.length;i++) {
									if(interntype == mock[i].time) {
										returnblock = mock[i].data;
									}
								}
								for(var j=0;j<returnblock.length;j++) {
									robot.showDialog(returnblock[j],returnblock[j].type)

								}
								break;
						}
					}
					var mock = [
						{	
							"time": "1478620399550",
							"description": "这个是申请流程",
							"data": [
								{
									"type": 2,
									"msg": "我想及一本书，但是过期了，我应该怎么办呢？"
								},
								{
									"type": 1,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
							],
							"tags": ['2016']
						},
						{	
							"time": "1447200000000",
							"description": "helloworld",
							"data": [
								{
									"type": 1,
									"msg": "我想及一本书，但是过期了，我应该怎么办呢？"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
							],
							"tags": ["2016"]
						},
						{	
							"time": "1478702254684",
							"description": "helloworld",
							"data": [
								{
									"type": 1,
									"msg": "我想及一本书，但是过期了，我应该怎么办呢？"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'>baidu</a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'>baidu</a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
							],
							"tags": ["2017"]
						},
					]
					var returnstr = "";
					//http://www.jb51.net/article/77066.htm
					bind($item, 'click', function(e) {

						var isshow = _('.detailbox')[0].style.display;

						/**
						 * type：string 年份，还是月份，还是日，还是内容
						 * data obj 数据
						**/
						// var $elem = showMore(3, mock);
						var $elem = showMore(1, mock);
						// console.log(returnstr)
						if(isshow == "block") {
							_('.detailbox')[0].setAttribute('style', "display:none");

						} else {
							_('.detailbox')[0].setAttribute('style', "display:block")
						}
						_('.detailbox')[0].appendChild($elem);
					})

</script>
</html>