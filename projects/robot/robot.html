<!DOCTYPE html>
<html>
<head>
	<title>this is a robot</title>
	<meta charset="utf8">
	<link rel="stylesheet" type="text/css" href="form.css">
 	<script type="text/javascript" src="./common.js"></script>
 	<script type="text/javascript" src="./robot.class.js"></script>
<style type="text/css">	
	.talkModule {
		width: 500px;
		position: fixed;
		top: 0px;
		right: 0px;
		background-color: #fff;
		border: 1px solid #eee;
	}
	.talkModule:after {

		display: table;
		clear: both;
		content: '';
	}

	
	.talkModule .item {
		/*position: absolute;*/

		display: block;
		margin-bottom: 10px
	}

	.talkModule .left {
		float: left;
		clear: both;
	}
	.talkModule .right {
		float: right;
		clear: both;
	}

	.talkModule .avatar {
		float: left;
		border-radius: 50%;
		overflow: hidden;
		width: 30px;
		height: 30px;
	}
	.talkModule .content {
		margin-left: 20px;
		font-size: 14px;
		color: #333;
		border-radius: 10px;
		background-color: skyblue;
		display: inline-block;
		padding:  10px;
		word-break: break-all;
	}
	.talkModule .right .avatar {
		float: right;
	}
	.talkModule .right .content {
		margin-left: 0px;
		margin-right: 20px;
	}


	.talkModule .body {
		padding: 10px;
		max-height: 460px;
		height: 300px;
		overflow-y:auto;
	}
	.talkModule .body:after {
		display: table;
		clear: both;
		content: ''
	}
	.talkModule .title {
		font-weight: bold;
		cursor: move;
		background-color: skyblue;
		height: 40px;
		line-height: 40px;
		text-align:center;
		display: block;
		width: 100%;
	}
	.collectBox .box {
		width:40px;
		height:40px;
		border-radius:8px;
		border:1px solid #ddd;
		background-color:rgba(255,255,255, .7);
		cursor: pointer;
		margin-bottom: 5px;

		position: relative;
	}

	.collectBox .box .mask {
		width:100%;
		height:100%;
		background-color:transparent;
		position:absolute;
		z-index:100;
		margin-top: -4px;
		margin-left: -4px;
		padding: 4px;
	}


	/*.collectBox .box:before {
		border: 1px solid #ddd;

		width: 18px;
		height: 18px;
		border-radius: 30%;
		content: '';
		display: inline-block;
	}*/

	.collectBox .box:hover {
		background-color: rgba(255,255,255, .3);
	}

	.collectBox .box.additem:before,.collectBox .box.additem:after {
		position: absolute;
		border-top: 4px solid #bbb;
		/*border-bottom: 4px solid #ddd;*/
		content: "";
		width: 30px;
		display: inline-block;
		left: 5px;
		top: 50%;
		margin-top: -2px;
	}

	.collectBox .box.additem:after {
		/*border-left: 4px solid #bbb;
		border-top: 0px;
		width: 0px;
		height: 40px;
		top: 0px;
		left: 50%;
		margin-left: -2px;
		margin-top: 0px;*/
		transform: rotate(90deg);
	}
	/*可以使用translate属性*/
	.collectBox .detailbox {
		display: none;
		position:absolute;
		top:48px;
		left:20px;
		right:20px;
		bottom:250px;
		background-color:rgba(255,255,255,.7);
		border:1px solid #ddd;
		border-radius: 30px;
		padding: 10px;
		overflow-y: auto;
		padding-top: 50px;
	}

	.collectBox .detailbox:after {
		content: attr(title);
		width: 100%;
		height: 40px;
		background-color: #ddd;
		text-align:center;
		line-height: 40px;
		font-weight: bold;
		display: inline-block;
		position: absolute;
		/*top: -40px;*/
		top: 0px;
		left: 0px;
		border-top-right-radius: 30px;
		border-top-left-radius: 30px;
	}

	.collectBox .detailbox .detailboxitem{
		width:40px;
		height:40px;
		border-radius:10px;
		border:1px solid #ddd;
		float: left;
		margin-right: 10px;
		margin-bottom: 10px;
		cursor: pointer;
		position: relative;
		line-height: 40px;
		/*width: 100%;*/
		/*overflow: hidden;*/
		text-overflow: ellipsis;
		text-align: center;
	}

	.collectBox .detailbox .detailboxitem:hover:before {
		z-index: 100;
		left: 0px;
		position: absolute;
		content: attr(value);
		display: inline-block;
		width: 100px;
		font-size: 12px;
		padding: 10px;
		border-radius: 10px;
		background-color: rgba(0,0,0,.7);
		top: 42px;
		color: #fff;
		line-height: normal;
	}

	.collectBox .detailbox .detailboxitem:hover {
		background-color: #ddd;
	}

	.collectBox .detailbox .detailboxitem:hover:after {
		position: absolute;
		content: "";
		display: inline-block;
		border-bottom: 12px solid rgba(0,0,0,.7);
		border-left: 8px solid transparent;
		border-right: 8px solid transparent;
		width: 0px;
		height: 0px;
	    top: 30px;
    	left: 10px;
	}

	.collectBox .item {
		display: inline-block;
		color: #333;
		font-size: 9px;
		text-align: center;
	}

	.fl {
		float: left;
	}

	.fr {
		float: right;
	}

	.display_tpl1 > .fl {
		color: red;
		width:100px;
	}

	.display_tpl1 > .content {
		margin-left: 100px;
	}


</style>
</head>
<body>
<div class="talkModule" style="display:block;">
	<div class="title">智能机器人</div>
	<div class="body">
		<!-- <div class="left item">
			<div class="avatar">
				<img src="http://placehold.it/30x30">
			</div>
			<div class="content">
				sdfsf
			</div>
		</div>
		<div class="right item">
			<div class="avatar">
				<img src="http://placehold.it/30x30">
			</div>
			<div class="content">
				sdfsf
			</div>
		</div> -->
	</div>
	<div class="formWrap"  style="margin-top:10px;background-color:#eee;display:block;clear:both;">
		<!-- <form> -->
			<p style="font-size:14px;padding:10px;color:#999;border-bottom:1px solid #bbb;">您可以选择业务类型：1、关键字查询 2、问问题 3、联合搜索 4、智能搜索 5、用户分析</p>
			<div class="collectBox"> 
				<div class="item">
					<div class="box"  value="收藏夹1">
						<div class="mask" value="收藏夹1"></div>
						<svg style="z-index:10;position:relative;top:0px;width:40px;height:40px;">
							<rect width="40" height="40" style="border-radius:10px;fill:transparent;border-radius:10px;"></rect>
							<circle cx="10" cy="10" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
							<circle cx="30" cy="10" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
							<circle cx="10" cy="30" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
							<circle cx="30" cy="30" r="8" style="fill:#fff;stroke:#ddd;stroke-width:1">11</circle>
						</svg>
					</div>
					<span>收藏夹1</span>
				</div>

				<div class="item">
					<div class="box"  value="收藏夹2"></div>
					<span>收藏夹2</span>
				</div>

				<div class="item">
					<div class="box" value="收藏夹3"></div>
					<span>收藏夹3</span>
				</div>

				<div class="item">
					<div class="box additem" style="font-size:60px;"></div>
					<span>命名1</span>
				</div>

				<div class="detailbox" title="收藏夹">
					<!-- <div class="detailboxitem" value="238238"></div>
					<div class="detailboxitem"></div> -->
				</div>
			</div>

			<div class="formItem"  id="sendMsg">
				<input type="" name="">
				<button>send</button>
				<button onclick="alert('暂未开放')">表情</button>
				<!--这个应该是通过用户的使用和操作，各方面得出来的结论，用户的需求。-->
				<button class="randomTopice">试试吧，说不定有惊喜呢/</button>
			</div>
			<div>
				功能按钮
				<button class="clearsc">clear screen</button>
				<button onclick="alert('暂未开放')">inform me</button>
				<button onclick="alert('暂未开放')">collect</button>
			</div>
			<!-- <div>
				<a href="">我的收藏</a>
				<a href="">用户分析</a>
				<a href="">我的提醒</a>
				<a href="">反馈</a>
			</div>
			<div>
				业务类型
				<button>1</button>
				<button>2</button>
				<button>3</button>
			</div> -->
			
		<!-- </form> -->
	</div>
</div>
</body>
<script type="text/javascript">
		//********** robot ********************//
	//robot 初始化
					var robot = new Robot();
					robot.init();
					// robot.robot();
					// robot.closeRobet()

					$item = _('.item');
					var $str = '<div class="detailboxitem" value="#value#">#content#</div>';
					//收藏过的数据id链接到保存的会话块。

					//显示一些东西
					//这是一个封装好的组件。
					//interntype 通过interntype来传递前一部点击的是什么年月日。
					function showMore (type, mock, interntype) {
						//timestemp生成器
						var xxx = new Date("2015-11-11");
						console.log(xxx.getTime())
						//年份
						switch(type) {
							case 1: 
								//show year
								var returnstr = "",
								yeararr = [];
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										date = new Date(parseInt(time)),
										year = date.getFullYear(),
										day = date.getDate();
									//所有的收藏日期day缓存
									if(yeararr.indexOf(year) == -1) { 
										yeararr.push(year);
									}
										// console.log(date, year, month,day)
								}
								yeararr.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0]);
								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(2, mock, e.srcElement.getAttribute("value"))
								});
								return $elem;
								break;
							case 2:
								//show month;
								var montharr = [],
									returnstr = "";
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										date = new Date(parseInt(time)),
										year = date.getFullYear(),
										month = date.getMonth();
										//用户点击是否同一年。
										if(parseInt(interntype) == year) {
											if(montharr.indexOf(month) == -1) {
												montharr.push(month);
											}
										}
								}
								montharr.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0]);

								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(3, mock, e.srcElement.getAttribute("value"));
									// _('.detailbox')[0].innerHTML = "";
								});
								_('.detailbox')[0].innerHTML = "";
								_('.detailbox')[0].appendChild($elem);
								break;
							case 3:
								//show day
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										returnstr = "",
										date = new Date(parseInt(time)),
										dayarr = [],
										month = date.getMonth(),
										day = date.getDate();
										if (interntype == month) {
											if(dayarr.indexOf(day) == -1) {
												dayarr.push(day);
											}
										} 
								}

								dayarr.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0])
									
								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(4, mock, e.srcElement.getAttribute("value"));
								});
								_('.detailbox')[0].innerHTML = "";
								_('.detailbox')[0].appendChild($elem);
								break;
							case 4:
								//show timestamp
								for(var i=0;i<mock.length;i++) {
									var time = mock[i].time,
										returnstr = "",
										date = new Date(parseInt(time)),
										now = [],
										month = date.getMonth(),
										day = date.getDate();
										console.log(interntype,day)
										if (interntype == day) {
											if(now.indexOf(time) == -1) {
												now.push(time);
											}
										} 
								}
								now.forEach(function() {
									returnstr += $str.replace("#value#", arguments[0]).replace("#content#", arguments[0])
									
								})
								var $elem = document.createElement("div");
								$elem.innerHTML = returnstr;
								bind($elem, 'click', function(e) {
									showMore(5, mock, e.srcElement.getAttribute("value"));
								});
								_('.detailbox')[0].innerHTML = "";
								_('.detailbox')[0].appendChild($elem);
								break;
							case 5:
								//display
								// for(var i=0;i<mock.length;i++) {
								// 	_('.detailbox')[0].style.display= "none";
								// 	robot.showDialog(mock[i],mock[i].type)
								// }
									_('.detailbox')[0].style.display= "none";

								for(var i=0;i<mock.length;i++) {
									if(interntype == mock[i].time) {
										returnblock = mock[i].data;
									}
								}
								for(var j=0;j<returnblock.length;j++) {
									robot.showDialog(returnblock[j],returnblock[j].type)

								}
								break;
						}
					}
					var mock = [
						{	
							"time": "1478620399550",
							"description": "这个是申请流程",
							"data": [
								{
									"type": 2,
									"msg": "我想及一本书，但是过期了，我应该怎么办呢？"
								},
								{
									"type": 1,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
								{
									"type": 1,
									"msg": "或者建议您可以去"
								},
							],
							"tags": ['2016']
						},
						{	
							"time": "1447200000000",
							"description": "helloworld",
							"data": [
								{
									"type": 1,
									"msg": "我想及一本书，但是过期了，我应该怎么办呢？"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
							],
							"tags": ["2016"]
						},
						{	
							"time": "1478702254684",
							"description": "helloworld",
							"data": [
								{
									"type": 1,
									"msg": "我想及一本书，但是过期了，我应该怎么办呢？"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'>baidu</a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'>baidu</a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
								{
									"type": 2,
									"msg": "您可以查看<a href='www.baidu.com'></a>参考申请流程"
								},
							],
							"tags": ["2017"]
						},
					]
					var returnstr = "";
					//http://www.jb51.net/article/77066.htm
					bind($item, 'click', function(e) {

						var isshow = _('.detailbox')[0].style.display;

						/**
						 * type：string 年份，还是月份，还是日，还是内容
						 * data obj 数据
						**/
						// var $elem = showMore(3, mock);
						var $elem = showMore(1, mock);
						// console.log(returnstr)
						if(isshow == "block") {
							_('.detailbox')[0].setAttribute('style', "display:none");

						} else {
							_('.detailbox')[0].setAttribute('style', "display:block")
						}
						_('.detailbox')[0].appendChild($elem);
					})

</script>
</html>